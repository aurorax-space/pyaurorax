<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>pyaurorax.tools.calibration API documentation</title>
<meta name="description" content="Perform various calibration procedures on image data." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}#lunr-search{width:100%;font-size:1em;padding:6px 9px 5px 9px;border:1px solid silver}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<style>
@media screen and (max-width: 699px) {
#content {
padding-left: 2em;
padding-right: 2em;
padding-top: 0;
}
}
@media screen and (min-width: 700px) {
#content {
max-width: 125ch;
padding-left: 3em;
padding-right: 3em;
padding-top: 1em;
border-left: 1px solid #ddd;
}
}
</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pyaurorax.tools.calibration</code></h1>
</header>
<section id="section-intro">
<p>Perform various calibration procedures on image data.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># Copyright 2024 University of Calgary
#
# Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
&#34;&#34;&#34;
Perform various calibration procedures on image data. 
&#34;&#34;&#34;

from ._rego import apply_calibration as rego
from ._trex_nir import apply_calibration as trex_nir

__all__ = [
    &#34;rego&#34;,
    &#34;trex_nir&#34;,
]</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="pyaurorax.tools.calibration.rego"><code class="name flex">
<span>def <span class="ident">rego</span></span>(<span>images:Â numpy.ndarray, cal_flatfield:Â Optional[pyucalgarysrs.data.classes.Calibration]Â =Â None, cal_rayleighs:Â Optional[pyucalgarysrs.data.classes.Calibration]Â =Â None, step_dark_frame_correction:Â boolÂ =Â True, step_flatfield_correction:Â boolÂ =Â True, step_rayleighs_conversion:Â boolÂ =Â True, exposure_length_sec:Â floatÂ =Â 2.0) â€‘>Â numpy.ndarray</span>
</code></dt>
<dd>
<div class="desc"><p>Apply various calibration adjustments to a single or set of images raw images.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>images</code></strong> :&ensp;<code>numpy.ndarray</code></dt>
<dd>Raw images to perform calibration procedures on.</dd>
<dt><strong><code>cal_flatfield</code></strong> :&ensp;<code><a title="pyaurorax.data.ucalgary.Calibration" href="../../data/ucalgary/index.html#pyaurorax.data.ucalgary.Calibration">Calibration</a></code></dt>
<dd>Calibration object containing the flatfield data to utilize. This field is required if
the <code>step_flatfield_corection</code> is set to True.</dd>
<dt><strong><code>cal_rayleighs</code></strong> :&ensp;<code><a title="pyaurorax.data.ucalgary.Calibration" href="../../data/ucalgary/index.html#pyaurorax.data.ucalgary.Calibration">Calibration</a></code></dt>
<dd>Calibration object containing the Rayleighs data to utilize. This field is required if
the <code>step_rayleighs_conversion</code> is set to True.</dd>
<dt><strong><code>step_dark_frame_correction</code></strong> :&ensp;<code>bool</code></dt>
<dd>Perform the dark frame correction step. Defaults to <code>True</code>.</dd>
<dt><strong><code>step_flatfield_correction</code></strong> :&ensp;<code>bool</code></dt>
<dd>Perform the flatfield correction step. Defaults to <code>True</code>. Note that the <code>cal_flatfield</code> parameter
must be supplied if this is True.</dd>
<dt><strong><code>step_rayleighs_conversion</code></strong> :&ensp;<code>bool</code></dt>
<dd>Perform the Rayleighs conversion step. Defaults to <code>True.</code> Note that the <code>cal_rayleighs</code> parameter
must be supplied if this is True.</dd>
<dt><strong><code>exposure_length_sec</code></strong> :&ensp;<code>float</code></dt>
<dd>Force the exposure length to be a certain value. Default is TREx NIR's nominal operating mode
exposure length of <code>2.0 seconds</code>. Adjusting this field should be done with caution.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>The calibrated images. </p>
<p>The shape of the calibrated data will be same as the input images. The dtype of the calibrated data
will depend on if the Rayleighs conversion was performed. If it was, a float32 array will be returned.
If it wasn't, the dtype will be the same as input images' dtype.</p>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>ValueError</code></dt>
<dd>issues encountered with supplied parameters.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def apply_calibration(
    images: np.ndarray,
    cal_flatfield: Optional[Calibration] = None,
    cal_rayleighs: Optional[Calibration] = None,
    step_dark_frame_correction: bool = True,
    step_flatfield_correction: bool = True,
    step_rayleighs_conversion: bool = True,
    exposure_length_sec: float = 2.0,
) -&gt; np.ndarray:
    &#34;&#34;&#34;
    Apply various calibration adjustments to a single or set of images raw images.

    Args:
        images (numpy.ndarray): 
            Raw images to perform calibration procedures on.
        cal_flatfield (pyaurorax.data.ucalgary.Calibration): 
            Calibration object containing the flatfield data to utilize. This field is required if
            the `step_flatfield_corection` is set to True.
        cal_rayleighs (pyaurorax.data.ucalgary.Calibration): 
            Calibration object containing the Rayleighs data to utilize. This field is required if 
            the `step_rayleighs_conversion` is set to True.
        step_dark_frame_correction (bool): 
            Perform the dark frame correction step. Defaults to `True`.
        step_flatfield_correction (bool): 
            Perform the flatfield correction step. Defaults to `True`. Note that the `cal_flatfield` parameter
            must be supplied if this is True.
        step_rayleighs_conversion (bool): 
            Perform the Rayleighs conversion step. Defaults to `True.` Note that the `cal_rayleighs` parameter
            must be supplied if this is True.
        exposure_length_sec (float): 
            Force the exposure length to be a certain value. Default is TREx NIR&#39;s nominal operating mode 
            exposure length of `2.0 seconds`. Adjusting this field should be done with caution.

    Returns:
        The calibrated images. 
        
        The shape of the calibrated data will be same as the input images. The dtype of the calibrated data 
        will depend on if the Rayleighs conversion was performed. If it was, a float32 array will be returned. 
        If it wasn&#39;t, the dtype will be the same as input images&#39; dtype.

    Raises:
        ValueError: issues encountered with supplied parameters.
    &#34;&#34;&#34;
    # verify that we have everything we need for each requested step
    if (step_flatfield_correction is True and cal_flatfield is None):
        raise ValueError(&#34;The cal_flatfield parameter must be supplied to perform the flatfield correction step&#34;)
    if (step_rayleighs_conversion is True and cal_rayleighs is None):
        raise ValueError(&#34;The cal_rayleighs parameter must be supplied to perform the rayleighs conversion step&#34;)

    # init
    calibrated_images = images

    # perform the dark frame correction
    #
    # NOTE: we do a 5x5 bottom corner mean
    if (step_dark_frame_correction is True):
        calibrated_images = perform_dark_frame_correction(images, 5)

    # apply the flatfield correction
    if (step_flatfield_correction is True and cal_flatfield is not None):
        calibrated_images = perform_flatfield_correction(calibrated_images, cal_flatfield)

    # apply the rayleighs conversion
    if (step_rayleighs_conversion is True and cal_rayleighs is not None):
        calibrated_images = perform_rayleighs_correction(calibrated_images, cal_rayleighs, exposure_length_sec)

    # return
    return calibrated_images</code></pre>
</details>
</dd>
<dt id="pyaurorax.tools.calibration.trex_nir"><code class="name flex">
<span>def <span class="ident">trex_nir</span></span>(<span>images:Â numpy.ndarray, cal_flatfield:Â Optional[pyucalgarysrs.data.classes.Calibration]Â =Â None, cal_rayleighs:Â Optional[pyucalgarysrs.data.classes.Calibration]Â =Â None, step_dark_frame_correction:Â boolÂ =Â True, step_flatfield_correction:Â boolÂ =Â True, step_rayleighs_conversion:Â boolÂ =Â True, exposure_length_sec:Â floatÂ =Â 5.0) â€‘>Â numpy.ndarray</span>
</code></dt>
<dd>
<div class="desc"><p>Apply various calibration adjustments to a single or set of images raw images.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>images</code></strong> :&ensp;<code>numpy.ndarray</code></dt>
<dd>Raw images to perform calibration procedures on.</dd>
<dt><strong><code>cal_flatfield</code></strong> :&ensp;<code><a title="pyaurorax.data.ucalgary.Calibration" href="../../data/ucalgary/index.html#pyaurorax.data.ucalgary.Calibration">Calibration</a></code></dt>
<dd>Calibration object containing the flatfield data to utilize. This field is required if
the <code>step_flatfield_corection</code> is set to True.</dd>
<dt><strong><code>cal_rayleighs</code></strong> :&ensp;<code><a title="pyaurorax.data.ucalgary.Calibration" href="../../data/ucalgary/index.html#pyaurorax.data.ucalgary.Calibration">Calibration</a></code></dt>
<dd>Calibration object containing the Rayleighs data to utilize. This field is required if
the <code>step_rayleighs_conversion</code> is set to True.</dd>
<dt><strong><code>step_dark_frame_correction</code></strong> :&ensp;<code>bool</code></dt>
<dd>Perform the dark frame correction step. Defaults to <code>True</code>.</dd>
<dt><strong><code>step_flatfield_correction</code></strong> :&ensp;<code>bool</code></dt>
<dd>Perform the flatfield correction step. Defaults to <code>True</code>. Note that the <code>cal_flatfield</code> parameter
must be supplied if this is True.</dd>
<dt><strong><code>step_rayleighs_conversion</code></strong> :&ensp;<code>bool</code></dt>
<dd>Perform the Rayleighs conversion step. Defaults to <code>True.</code> Note that the <code>cal_rayleighs</code> parameter
must be supplied if this is True.</dd>
<dt><strong><code>exposure_length_sec</code></strong> :&ensp;<code>float</code></dt>
<dd>Force the exposure length to be a certain value. Default is TREx NIR's nominal operating mode
exposure length of <code>5.0 seconds</code>. Adjusting this field should be done with caution.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>The calibrated images. </p>
<p>The shape of the calibrated data will be same as the input images. The dtype of the calibrated data
will depend on if the Rayleighs conversion was performed. If it was, a float32 array will be returned.
If it wasn't, the dtype will be the same as input images' dtype.</p>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>ValueError</code></dt>
<dd>issues encountered with supplied parameters.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def apply_calibration(
    images: np.ndarray,
    cal_flatfield: Optional[Calibration] = None,
    cal_rayleighs: Optional[Calibration] = None,
    step_dark_frame_correction: bool = True,
    step_flatfield_correction: bool = True,
    step_rayleighs_conversion: bool = True,
    exposure_length_sec: float = 5.0,
) -&gt; np.ndarray:
    &#34;&#34;&#34;
    Apply various calibration adjustments to a single or set of images raw images.

    Args:
        images (numpy.ndarray): 
            Raw images to perform calibration procedures on.
        cal_flatfield (pyaurorax.data.ucalgary.Calibration): 
            Calibration object containing the flatfield data to utilize. This field is required if
            the `step_flatfield_corection` is set to True.
        cal_rayleighs (pyaurorax.data.ucalgary.Calibration): 
            Calibration object containing the Rayleighs data to utilize. This field is required if 
            the `step_rayleighs_conversion` is set to True.
        step_dark_frame_correction (bool): 
            Perform the dark frame correction step. Defaults to `True`.
        step_flatfield_correction (bool): 
            Perform the flatfield correction step. Defaults to `True`. Note that the `cal_flatfield` parameter
            must be supplied if this is True.
        step_rayleighs_conversion (bool): 
            Perform the Rayleighs conversion step. Defaults to `True.` Note that the `cal_rayleighs` parameter
            must be supplied if this is True.
        exposure_length_sec (float): 
            Force the exposure length to be a certain value. Default is TREx NIR&#39;s nominal operating mode 
            exposure length of `5.0 seconds`. Adjusting this field should be done with caution.

    Returns:
        The calibrated images. 
        
        The shape of the calibrated data will be same as the input images. The dtype of the calibrated data 
        will depend on if the Rayleighs conversion was performed. If it was, a float32 array will be returned. 
        If it wasn&#39;t, the dtype will be the same as input images&#39; dtype.

    Raises:
        ValueError: issues encountered with supplied parameters.
    &#34;&#34;&#34;
    # verify that we have everything we need for each requested step
    if (step_flatfield_correction is True and cal_flatfield is None):
        raise ValueError(&#34;The cal_flatfield parameter must be supplied to perform the flatfield correction step&#34;)
    if (step_rayleighs_conversion is True and cal_rayleighs is None):
        raise ValueError(&#34;The cal_rayleighs parameter must be supplied to perform the rayleighs conversion step&#34;)

    # init
    calibrated_images = images

    # perform the dark frame correction
    #
    # NOTE: we do a 4x4 bottom corner mean
    if (step_dark_frame_correction is True):
        calibrated_images = perform_dark_frame_correction(images, 5)

    # apply the flatfield correction
    if (step_flatfield_correction is True and cal_flatfield is not None):
        calibrated_images = perform_flatfield_correction(calibrated_images, cal_flatfield)

    # apply the rayleighs conversion
    if (step_rayleighs_conversion is True and cal_rayleighs is not None):
        calibrated_images = perform_rayleighs_correction(calibrated_images, cal_rayleighs, exposure_length_sec)

    # return
    return calibrated_images</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<form>
<input id="lunr-search" name="q" placeholder="ðŸ”Ž Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../../../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pyaurorax.tools" href="../index.html">pyaurorax.tools</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="pyaurorax.tools.calibration.rego" href="#pyaurorax.tools.calibration.rego">rego</a></code></li>
<li><code><a title="pyaurorax.tools.calibration.trex_nir" href="#pyaurorax.tools.calibration.trex_nir">trex_nir</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>